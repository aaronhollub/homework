<% highest_rating = 0 %>
<% editors_pick_book = "" %>
<% editors_pick_book_id = "" %>

<% all_books = Book.read %>
<% all_books.each do |book| %>

	<% author = Author.find_by("id" => book["author_id"]) %>
	<% review = Review.where("book_id" => book["id"]) %>
	<% average_rating = review.average(:rating) %>

	<% if average_rating == nil then %>
		<% average_rating = 0 %>
	<% end %>	

	<% if average_rating > highest_rating then %>
		<% highest_rating = average_rating %>
		<% editors_pick_book = book["title"] %>
		<% editors_pick_book_id = book.id %>
	<% end %>

<% end %>

<h1>Welcome to Aaron's Bookstore</h1>

<p> 
	<%= link_to "List of Books", "/books" %> | <%= link_to "Editor's Pick: #{editors_pick_book}", "/books/#{editors_pick_book_id}" %>

</p>

<hr>

<%= link_to image_tag(("http://d27tm.org/wp-content/uploads/2014/04/Boulder-Bookstore_Sam-Hall.jpg"), "width" => "400"), "/books" %>
